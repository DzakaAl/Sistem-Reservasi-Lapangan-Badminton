<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Riwayat Reservasi</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />
    <style>
      html,
      body {
        height: 100%;
      }
      body {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        background: #f4f8fb;
        font-family: "Segoe UI", Arial, sans-serif;
        color: #003366;
      }
      header.shadow-sm {
        background: linear-gradient(90deg, #3399ff 60%, #003366 100%);
        color: #fff;
        position: sticky;
        top: 0;
        z-index: 100;
      }
      header .container-fluid {
        padding: 0.5rem 1rem;
      }
      header .nav-link {
        border-radius: 6px;
        transition: background 0.15s, color 0.15s;
      }
      header .nav-link:hover {
        background: #fff !important;
        color: #003366 !important;
        font-weight: 700;
      }
      @media (max-width: 767.98px) {
        header .container-fluid {
          flex-direction: column;
          gap: 0.5rem;
          align-items: flex-start;
        }
        header nav ul {
          gap: 0.5rem;
        }
        header .fw-bold.fs-5 {
          font-size: 1.1rem !important;
        }
      }
      main {
        flex: 1 0 auto;
        max-width: 1200px;
        margin: 2.5rem auto 0 auto;
        background: #fff;
        border-radius: 18px;
        box-shadow: 0 2px 16px rgba(51, 153, 255, 0.07);
        padding: 2.5rem 2rem 2rem 2rem;
      }
      .riwayat-section h2 {
        font-size: 1.5rem;
        font-weight: 700;
        color: #003366;
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }
      .table-riwayat {
        width: 100%;
        table-layout: fixed; /* agar kolom proporsional dan penuh */
      }
      .table-riwayat th,
      .table-riwayat td {
        text-align: center;
        vertical-align: middle;
        font-size: 1rem;
        word-break: break-word;
        padding-left: 0.5rem;
        padding-right: 0.5rem;
      }
      .table-riwayat th,
      .table-riwayat td {
        min-width: 120px;
      }
      .table-riwayat th.no-col,
      .table-riwayat td.no-col {
        min-width: 40px;
        width: 4%;
        max-width: 50px;
        padding-left: 0.2rem;
        padding-right: 0.2rem;
      }
      .table-riwayat th.status-col,
      .table-riwayat td.status-col {
        min-width: 170px;
        width: 22%;
        white-space: normal; /* allow wrapping */
        word-break: break-word;
      }
      .table-riwayat th {
        background: #3399ff;
        color: #fff;
        font-weight: 600;
        border-bottom: 2px solid #eaf6ff;
      }
      .table-riwayat tr:last-child td {
        border-bottom: 2px solid #3399ff;
      }
      .table-riwayat td {
        background: #f8fafc;
      }
      .table-riwayat .badge-status {
        font-size: 0.98rem;
        font-weight: 600;
        border-radius: 1rem;
        padding: 0.5em 1.2em;
        letter-spacing: 0.2px;
        display: inline-flex;
        align-items: center;
        gap: 0.4em;
        border: none;
        box-shadow: none;
        white-space: normal; /* allow badge text to wrap */
        word-break: break-word;
        text-align: center;
        justify-content: center;
      }
      .table-riwayat .badge-Konfirmasi {
        background: linear-gradient(90deg, #4ade80, #22d3ee);
        color: #003366;
        box-shadow: 0 2px 8px #4ade8033;
      }
      .table-riwayat .badge-menunggu {
        background: linear-gradient(90deg, #facc15, #fbbf24);
        color: #7c5700;
        box-shadow: 0 2px 8px #facc1533;
      }
      .table-riwayat .badge-batal {
        background: linear-gradient(90deg, #f87171, #f43f5e);
        color: #fff;
        box-shadow: 0 2px 8px #f8717133;
      }
      footer {
        flex-shrink: 0;
        background: #003366;
        color: #fff;
        text-align: center;
        padding: 1.5rem 0 1rem 0;
        margin-top: 2rem;
        border-radius: 18px 18px 0 0;
        font-size: 1rem;
      }
      @media (max-width: 991.98px) {
        .table-riwayat th.status-col,
        .table-riwayat td.status-col {
          min-width: 120px;
          width: 22%;
        }
        main {
          padding: 1.2rem 0.2rem;
        }
      }
      @media (max-width: 767.98px) {
        main {
          padding: 0.7rem 0.2rem;
        }
        .riwayat-section h2 {
          font-size: 1.1rem;
        }
        .table-riwayat th,
        .table-riwayat td {
          font-size: 0.92rem;
          padding: 0.4rem 0.2rem;
        }
      }
    </style>
  </head>
  <body>
    <!-- Header modern dan rapi -->
    <header class="shadow-sm">
      <div
        class="container-fluid d-flex align-items-center justify-content-between py-2 px-3 flex-wrap"
      >
        <div class="d-flex align-items-center gap-2">
          <img
            src="gambar/logo.png"
            alt="Logo"
            class="rounded-circle shadow-sm"
            style="
              width: 40px;
              height: 40px;
              object-fit: cover;
              background: #fff;
              padding: 4px;
            "
          />
          <span class="fw-bold fs-5 ms-2">Sistem Reservasi Badminton</span>
        </div>
        <nav>
          <ul
            class="d-flex gap-3 mb-0 list-unstyled align-items-center"
            id="navbarMenu"
          >
            <li>
              <a
                href="index.html"
                class="nav-link text-white fw-semibold px-2 py-1"
                >Home</a
              >
            </li>
            <li>
              <a
                href="jadwal.html"
                class="nav-link text-white fw-semibold px-2 py-1"
                >Jadwal</a
              >
            </li>
            <li>
              <a
                href="riwayat.html"
                class="nav-link text-white fw-semibold px-2 py-1"
                >Riwayat</a
              >
            </li>
            <li>
              <a
                href="about.html"
                class="nav-link text-white fw-semibold px-2 py-1"
                >Tentang Kami</a
              >
            </li>
            <li id="loginLogoutNav">
              <a
                href="login.html"
                class="nav-link text-white fw-semibold px-2 py-1"
                id="loginLogoutLink"
                >Login</a
              >
            </li>
          </ul>
        </nav>
      </div>
    </header>

    <main>
      <section class="riwayat-section">
        <h2>
          <i class="bi bi-clock-history text-primary"></i> Riwayat Reservasi
          Anda
        </h2>
        <div class="card border-0 shadow-sm">
          <div class="card-body p-0">
            <div class="table-responsive">
              <table class="table table-riwayat mb-0">
                <thead>
                  <tr>
                    <th class="no-col">No</th>
                    <th>Nama</th>
                    <th>Lapangan</th>
                    <th>Tanggal</th>
                    <th>Jam</th>
                    <th class="status-col">Status</th>
                  </tr>
                </thead>
                <tbody id="riwayat-body">
                  <tr>
                    <td colspan="6">Memuat data...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer>
      <p><strong>Alamat:</strong> Sayangan, Bandung, Playen, Gunungkidul Regency, Special Region of Yogyakarta 55861</p>
      <p>
        <strong>Telepon:</strong> +62 811-2645-838 
      </p>
      <p>
        &copy; 2025 Sistem Reservasi Lapangan Badminton. All rights reserved.
      </p>
    </footer>

    <script>
      // Navbar login/logout session-based (AJAX ke backend)
      document.addEventListener("DOMContentLoaded", function () {
        fetch("api/check.php")
          .then((res) => res.json())
          .then((data) => {
            const loginLogoutLink = document.getElementById("loginLogoutLink");
            if (data.loggedIn) {
              loginLogoutLink.textContent = "Logout";
              loginLogoutLink.href = "logout.php";
              loginLogoutLink.classList.add("text-white");
              loginLogoutLink.onclick = function () {
                window.location.href = "logout.php";
                return false;
              };
            } else {
              loginLogoutLink.textContent = "Login";
              loginLogoutLink.href = "login.html";
              loginLogoutLink.classList.add("text-white");
              loginLogoutLink.onclick = null;
            }
          });
      });

      // Fungsi cek login (opsional, jika ingin redirect ke login jika belum login)
      async function checkLoginStatus() {
        const res = await fetch("api/check.php");
        const data = await res.json();
        if (!data.loggedIn) window.location.href = "login.html";
        return data.user_id;
      }

      document.addEventListener("DOMContentLoaded", async function () {
        await checkLoginStatus();
        const tbody = document.getElementById("riwayat-body");
        fetch("api/riwayat.php")
          .then((res) => res.json())
          .then((data) => {
            tbody.innerHTML = "";
            if (!Array.isArray(data) || data.length === 0) {
              tbody.innerHTML = `<tr><td colspan="6">Belum ada riwayat reservasi.</td></tr>`;
              return;
            }
            data.forEach((item, idx) => {
              let badgeClass = "badge-menunggu";
              let badgeIcon = '<i class="bi bi-hourglass-split"></i>';
              let statusText = item.status ?? "-";
              if (
                item.status === "Dikonfirmasi" ||
                item.status === "Konfirmasi" ||
                item.status === "Sukses" ||
                item.status === "Berhasil"
              ) {
                badgeClass = "badge-Konfirmasi";
                badgeIcon = '<i class="bi bi-check-circle-fill"></i>';
                statusText = "Dikonfirmasi";
              } else if (
                item.status === "Menunggu Konfirmasi" ||
                item.status === "Pending" ||
                item.status === "Menunggu"
              ) {
                badgeClass = "badge-menunggu";
                badgeIcon = '<i class="bi bi-hourglass-split"></i>';
                statusText = "Menunggu Konfirmasi";
              } else if (
                item.status === "Dibatalkan" ||
                item.status === "Batal" ||
                item.status === "Cancel"
              ) {
                badgeClass = "badge-batal";
                badgeIcon = '<i class="bi bi-x-circle-fill"></i>';
                statusText = "Dibatalkan";
              }
              tbody.innerHTML += `
            <tr>
              <td class="no-col">${idx + 1}</td>
              <td>${item.nama_reservasi ?? "-"}</td>
              <td>${item.lapangan ?? "-"}</td>
              <td>${item.tanggal ?? "-"}</td>
              <td>${item.jam ?? "-"}</td>
              <td class="status-col"><span class="badge-status ${badgeClass}">${badgeIcon} ${statusText}</span></td>
            </tr>
          `;
            });
          })
          .catch(() => {
            tbody.innerHTML = `<tr><td colspan="6">Gagal memuat data.</td></tr>`;
          });
      });
    </script>
  </body>
</html>
